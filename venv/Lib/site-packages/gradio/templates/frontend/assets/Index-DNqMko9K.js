const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./module-FFb15TvM.js","./module-BTkNA4K1.js","./module-8x-imyhh.js"])))=>i.map(i=>d[i]);
import"./svelte/svelte_internal_flags_async.js";import*as e from"./svelte/svelte_internal_client.js";import{createEventDispatcher as be,onMount as ge,onDestroy as Ee,tick as Te}from"./svelte/svelte_svelte.js";import"./i18n-jwgpNIDD.js";import{f as Z,G as Le}from"./utils.svelte-Ceck75cM.js";import{a as qe,S as xe}from"./StreamingBar-CiZ1eSYP.js";import{s as ke,u as he,W as Ce,p as We,A as ze,S as Fe}from"./StaticAudio-5wvTyFVp.js";import"./svelte/svelte_internal_flags_legacy.js";import{M as De,U as Ne}from"./ModifyUpload-BeEGCb3i.js";import{_ as Pe,p as Ge}from"./index-CGvp2os9.js";import{x as He,H as Ve,b as Ye,v as Je,o as Ke,B as Se,U as Qe}from"./IconButtonWrapper-CKkeBFM2.js";function fe(I,t,s,a){return new(s||(s=Promise))((function(u,r){function o(m){try{h(a.next(m))}catch(l){r(l)}}function p(m){try{h(a.throw(m))}catch(l){r(l)}}function h(m){var l;m.done?u(m.value):(l=m.value,l instanceof s?l:new s((function(n){n(l)}))).then(o,p)}h((a=a.apply(I,[])).next())}))}class Me{constructor(){this.listeners={}}on(t,s,a){if(this.listeners[t]||(this.listeners[t]=new Set),a?.once){const u=(...r)=>{this.un(t,u),s(...r)};return this.listeners[t].add(u),()=>this.un(t,u)}return this.listeners[t].add(s),()=>this.un(t,s)}un(t,s){var a;(a=this.listeners[t])===null||a===void 0||a.delete(s)}once(t,s){return this.on(t,s,{once:!0})}unAll(){this.listeners={}}emit(t,...s){this.listeners[t]&&this.listeners[t].forEach((a=>a(...s)))}}class Xe extends Me{constructor(t){super(),this.subscriptions=[],this.isDestroyed=!1,this.options=t}onInit(){}_init(t){this.isDestroyed&&(this.subscriptions=[],this.isDestroyed=!1),this.wavesurfer=t,this.onInit()}destroy(){this.emit("destroy"),this.subscriptions.forEach((t=>t())),this.subscriptions=[],this.isDestroyed=!0,this.wavesurfer=void 0}}class Ze extends Me{constructor(){super(...arguments),this.animationFrameId=null,this.isRunning=!1}start(){if(this.isRunning)return;this.isRunning=!0;const t=()=>{this.isRunning&&(this.emit("tick"),this.animationFrameId=requestAnimationFrame(t))};t()}stop(){this.isRunning=!1,this.animationFrameId!==null&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)}destroy(){this.stop()}}const $e=["audio/webm","audio/wav","audio/mpeg","audio/mp4","audio/mp3"];class de extends Xe{constructor(t){var s,a,u,r,o,p;super(Object.assign(Object.assign({},t),{audioBitsPerSecond:(s=t.audioBitsPerSecond)!==null&&s!==void 0?s:128e3,scrollingWaveform:(a=t.scrollingWaveform)!==null&&a!==void 0&&a,scrollingWaveformWindow:(u=t.scrollingWaveformWindow)!==null&&u!==void 0?u:5,continuousWaveform:(r=t.continuousWaveform)!==null&&r!==void 0&&r,renderRecordedAudio:(o=t.renderRecordedAudio)===null||o===void 0||o,mediaRecorderTimeslice:(p=t.mediaRecorderTimeslice)!==null&&p!==void 0?p:void 0})),this.stream=null,this.mediaRecorder=null,this.dataWindow=null,this.isWaveformPaused=!1,this.lastStartTime=0,this.lastDuration=0,this.duration=0,this.micStream=null,this.recordedBlobUrl=null,this.timer=new Ze,this.subscriptions.push(this.timer.on("tick",(()=>{const h=performance.now()-this.lastStartTime;this.duration=this.isPaused()?this.duration:this.lastDuration+h,this.emit("record-progress",this.duration)})))}static create(t){return new de(t||{})}renderMicStream(t){var s;const a=new AudioContext,u=a.createMediaStreamSource(t),r=a.createAnalyser();u.connect(r),this.options.continuousWaveform&&(r.fftSize=32);const o=r.frequencyBinCount,p=new Float32Array(o);let h=0;this.wavesurfer&&((s=this.originalOptions)!==null&&s!==void 0||(this.originalOptions=Object.assign({},this.wavesurfer.options)),this.wavesurfer.options.interact=!1,this.options.scrollingWaveform&&(this.wavesurfer.options.cursorWidth=0));const m=setInterval((()=>{var l,n,_,y;if(!this.isWaveformPaused){if(r.getFloatTimeDomainData(p),this.options.scrollingWaveform){const v=Math.floor((this.options.scrollingWaveformWindow||0)*a.sampleRate),f=Math.min(v,this.dataWindow?this.dataWindow.length+o:o),R=new Float32Array(v);if(this.dataWindow){const D=Math.max(0,v-this.dataWindow.length);R.set(this.dataWindow.slice(-f+o),D)}R.set(p,v-o),this.dataWindow=R}else if(this.options.continuousWaveform){if(!this.dataWindow){const f=this.options.continuousWaveformDuration?Math.round(100*this.options.continuousWaveformDuration):((n=(l=this.wavesurfer)===null||l===void 0?void 0:l.getWidth())!==null&&n!==void 0?n:0)*window.devicePixelRatio;this.dataWindow=new Float32Array(f)}let v=0;for(let f=0;f<o;f++){const R=Math.abs(p[f]);R>v&&(v=R)}if(h+1>this.dataWindow.length){const f=new Float32Array(2*this.dataWindow.length);f.set(this.dataWindow,0),this.dataWindow=f}this.dataWindow[h]=v,h++}else this.dataWindow=p;if(this.wavesurfer){const v=((y=(_=this.dataWindow)===null||_===void 0?void 0:_.length)!==null&&y!==void 0?y:0)/100;this.wavesurfer.load("",[this.dataWindow],this.options.scrollingWaveform?this.options.scrollingWaveformWindow:v).then((()=>{this.wavesurfer&&this.options.continuousWaveform&&(this.wavesurfer.setTime(this.getDuration()/1e3),this.wavesurfer.options.minPxPerSec||this.wavesurfer.setOptions({minPxPerSec:this.wavesurfer.getWidth()/this.wavesurfer.getDuration()}))})).catch((f=>{console.error("Error rendering real-time recording data:",f)}))}}}),10);return{onDestroy:()=>{clearInterval(m),u?.disconnect(),a?.close()},onEnd:()=>{this.isWaveformPaused=!0,this.stopMic()}}}startMic(t){return fe(this,void 0,void 0,(function*(){let s;this.micStream&&this.stopMic();try{s=yield navigator.mediaDevices.getUserMedia({audio:t==null||t})}catch(u){throw new Error("Error accessing the microphone: "+u.message)}const a=this.renderMicStream(s);return this.micStream=a,this.unsubscribeDestroy=this.once("destroy",a.onDestroy),this.unsubscribeRecordEnd=this.once("record-end",a.onEnd),this.stream=s,s}))}stopMic(){var t,s,a;(t=this.micStream)===null||t===void 0||t.onDestroy(),(s=this.unsubscribeDestroy)===null||s===void 0||s.call(this),(a=this.unsubscribeRecordEnd)===null||a===void 0||a.call(this),this.micStream=null,this.unsubscribeDestroy=void 0,this.unsubscribeRecordEnd=void 0,this.stream&&(this.stream.getTracks().forEach((u=>u.stop())),this.stream=null,this.mediaRecorder=null)}startRecording(t){return fe(this,void 0,void 0,(function*(){const s=this.stream||(yield this.startMic(t));this.dataWindow=null;const a=this.mediaRecorder||new MediaRecorder(s,{mimeType:this.options.mimeType||$e.find((o=>MediaRecorder.isTypeSupported(o))),audioBitsPerSecond:this.options.audioBitsPerSecond});this.mediaRecorder=a,this.stopRecording();const u=[];a.ondataavailable=o=>{o.data.size>0&&u.push(o.data),this.emit("record-data-available",o.data)};const r=o=>{var p;const h=new Blob(u,{type:a.mimeType});this.emit(o,h),this.options.renderRecordedAudio&&(this.applyOriginalOptionsIfNeeded(),this.recordedBlobUrl&&URL.revokeObjectURL(this.recordedBlobUrl),this.recordedBlobUrl=URL.createObjectURL(h),(p=this.wavesurfer)===null||p===void 0||p.load(this.recordedBlobUrl))};a.onpause=()=>r("record-pause"),a.onstop=()=>r("record-end"),a.start(this.options.mediaRecorderTimeslice),this.lastStartTime=performance.now(),this.lastDuration=0,this.duration=0,this.isWaveformPaused=!1,this.timer.start(),this.emit("record-start")}))}getDuration(){return this.duration}isRecording(){var t;return((t=this.mediaRecorder)===null||t===void 0?void 0:t.state)==="recording"}isPaused(){var t;return((t=this.mediaRecorder)===null||t===void 0?void 0:t.state)==="paused"}isActive(){var t;return((t=this.mediaRecorder)===null||t===void 0?void 0:t.state)!=="inactive"}stopRecording(){var t;this.isActive()&&((t=this.mediaRecorder)===null||t===void 0||t.stop(),this.timer.stop())}pauseRecording(){var t,s;this.isRecording()&&(this.isWaveformPaused=!0,(t=this.mediaRecorder)===null||t===void 0||t.requestData(),(s=this.mediaRecorder)===null||s===void 0||s.pause(),this.timer.stop(),this.lastDuration=this.duration)}resumeRecording(){var t;this.isPaused()&&(this.isWaveformPaused=!1,(t=this.mediaRecorder)===null||t===void 0||t.resume(),this.timer.start(),this.lastStartTime=performance.now(),this.emit("record-resume"))}static getAvailableAudioDevices(){return fe(this,void 0,void 0,(function*(){return navigator.mediaDevices.enumerateDevices().then((t=>t.filter((s=>s.kind==="audioinput"))))}))}destroy(){this.applyOriginalOptionsIfNeeded(),super.destroy(),this.stopRecording(),this.stopMic(),this.recordedBlobUrl&&(URL.revokeObjectURL(this.recordedBlobUrl),this.recordedBlobUrl=null)}applyOriginalOptionsIfNeeded(){this.wavesurfer&&this.originalOptions&&(this.wavesurfer.setOptions(this.originalOptions),delete this.originalOptions)}}var et=e.from_html("<option> </option>"),tt=e.from_html("<option> </option>"),rt=e.from_html('<select class="mic-select svelte-ym1wxn" aria-label="Select input device"><!></select>');function Be(I,t){e.push(t,!1);let s=e.prop(t,"i18n",12),a=e.prop(t,"micDevices",28,()=>[]);const u=be();e.legacy_pre_effect(()=>e.deep_read_state(s()),()=>{if(typeof window<"u")try{let l=[];de.getAvailableAudioDevices().then(n=>{a(n),n.forEach(_=>{_.deviceId&&l.push(_)}),a(l)})}catch(l){throw l instanceof DOMException&&l.name=="NotAllowedError"&&u("error",s()("audio.allow_recording_access")),l}}),e.legacy_pre_effect_reset();var r={get i18n(){return s()},set i18n(l){s(l),e.flush()},get micDevices(){return a()},set micDevices(l){a(l),e.flush()}};e.init();var o=rt(),p=e.child(o);{var h=l=>{var n=et(),_=e.child(n,!0);e.reset(n),n.value=n.__value="",e.template_effect(y=>e.set_text(_,y),[()=>(e.deep_read_state(s()),e.untrack(()=>s()("audio.no_microphone")))]),e.append(l,n)},m=l=>{var n=e.comment(),_=e.first_child(n);e.each(_,1,a,e.index,(y,v)=>{var f=tt(),R=e.child(f,!0);e.reset(f);var D={};e.template_effect(()=>{e.set_text(R,(e.get(v),e.untrack(()=>e.get(v).label))),D!==(D=(e.get(v),e.untrack(()=>e.get(v).deviceId)))&&(f.value=(f.__value=(e.get(v),e.untrack(()=>e.get(v).deviceId)))??"")}),e.append(y,f)}),e.append(l,n)};e.if(p,l=>{e.deep_read_state(a()),e.untrack(()=>a().length===0)?l(h):l(m,!1)})}return e.reset(o),e.template_effect(()=>o.disabled=(e.deep_read_state(a()),e.untrack(()=>a().length===0))),e.append(I,o),e.pop(r)}var st=e.from_html('<time class="duration-button duration svelte-1xuh0j1"> </time>'),at=e.from_html('<div class="controls svelte-1xuh0j1"><div class="wrapper svelte-1xuh0j1"><button class="record record-button svelte-1xuh0j1"> </button> <button> </button> <button id="stop-paused" class="stop-button-paused svelte-1xuh0j1"> </button> <button aria-label="pause" class="pause-button svelte-1xuh0j1"><!></button> <button class="resume-button svelte-1xuh0j1"> </button> <!></div> <!></div>');function it(I,t){e.push(t,!1);let s=e.prop(t,"record",12),a=e.prop(t,"i18n",12),u=e.prop(t,"recording",12,!1),r=e.mutable_source([]),o=e.mutable_source(),p=e.mutable_source(),h=e.mutable_source(),m=e.mutable_source(),l=e.mutable_source(),n=e.mutable_source(!1),_=e.prop(t,"record_time",12),y=e.prop(t,"show_recording_waveform",12),v=e.prop(t,"timing",12,!1);const f=()=>{e.mutate(o,e.get(o).style.display="none"),e.mutate(m,e.get(m).style.display="flex"),e.mutate(p,e.get(p).style.display="block")},R=()=>{s().isPaused()&&(s().resumeRecording(),s().stopRecording()),s().stopMic(),e.mutate(o,e.get(o).style.display="flex"),e.mutate(m,e.get(m).style.display="none"),e.mutate(p,e.get(p).style.display="none"),e.mutate(o,e.get(o).disabled=!1)},D=()=>{e.mutate(p,e.get(p).style.display="none"),e.mutate(h,e.get(h).style.display="block"),e.mutate(m,e.get(m).style.display="none"),e.mutate(l,e.get(l).style.display="flex")},B=()=>{e.mutate(p,e.get(p).style.display="block"),e.mutate(h,e.get(h).style.display="none"),e.mutate(o,e.get(o).style.display="none"),e.mutate(m,e.get(m).style.display="flex"),e.mutate(l,e.get(l).style.display="none")};ge(()=>{s().on("record-start",f),s().on("record-end",R),s().on("record-pause",D),s().on("record-resume",B)}),Ee(()=>{s().un("record-start",f),s().un("record-end",R),s().un("record-pause",D),s().un("record-resume",B)}),e.legacy_pre_effect(()=>(e.deep_read_state(u()),e.get(n),e.deep_read_state(s())),()=>{u()&&!e.get(n)?s().startMic().then(()=>{s().startRecording(),e.set(n,!0)}):!u()&&e.get(n)&&(s().isPaused()&&s().resumeRecording(),s().stopRecording(),e.set(n,!1))}),e.legacy_pre_effect_reset();var N={get record(){return s()},set record(w){s(w),e.flush()},get i18n(){return a()},set i18n(w){a(w),e.flush()},get recording(){return u()},set recording(w){u(w),e.flush()},get record_time(){return _()},set record_time(w){_(w),e.flush()},get show_recording_waveform(){return y()},set show_recording_waveform(w){y(w),e.flush()},get timing(){return v()},set timing(w){v(w),e.flush()}};e.init();var A=at(),j=e.child(A),x=e.child(j),E=e.child(x,!0);e.reset(x),e.bind_this(x,w=>e.set(o,w),()=>e.get(o));var c=e.sibling(x,2),b=e.child(c,!0);e.reset(c),e.bind_this(c,w=>e.set(m,w),()=>e.get(m));var S=e.sibling(c,2),M=e.child(S,!0);e.reset(S),e.bind_this(S,w=>e.set(l,w),()=>e.get(l));var U=e.sibling(S,2),O=e.child(U);He(O),e.reset(U),e.bind_this(U,w=>e.set(p,w),()=>e.get(p));var k=e.sibling(U,2),g=e.child(k,!0);e.reset(k),e.bind_this(k,w=>e.set(h,w),()=>e.get(h));var T=e.sibling(k,2);{var C=w=>{var Y=st(),ee=e.child(Y,!0);e.reset(Y),e.template_effect(()=>e.set_text(ee,_())),e.append(w,Y)};e.if(T,w=>{v()&&!y()&&w(C)})}e.reset(j);var G=e.sibling(j,2);return Be(G,{get i18n(){return a()},get micDevices(){return e.get(r)},set micDevices(w){e.set(r,w)},$$legacy:!0}),e.reset(A),e.template_effect((w,Y,ee,re,$)=>{e.set_text(E,w),e.set_class(c,1,`stop-button ${Y??""}`,"svelte-1xuh0j1"),e.set_text(b,ee),e.set_text(M,re),e.set_text(g,$)},[()=>(e.deep_read_state(a()),e.untrack(()=>a()("audio.record"))),()=>(e.deep_read_state(s()),e.untrack(()=>s().isPaused()?"stop-button-paused":"")),()=>(e.deep_read_state(a()),e.untrack(()=>a()("audio.stop"))),()=>(e.deep_read_state(a()),e.untrack(()=>a()("audio.stop"))),()=>(e.deep_read_state(a()),e.untrack(()=>a()("audio.resume")))]),e.event("click",x,()=>s().startRecording()),e.event("click",c,()=>{s().isPaused()&&(s().resumeRecording(),s().stopRecording()),s().stopRecording()}),e.event("click",S,()=>{s().isPaused()&&(s().resumeRecording(),s().stopRecording()),s().stopRecording()}),e.event("click",U,()=>s().pauseRecording()),e.event("click",k,()=>s().resumeRecording()),e.append(I,A),e.pop(N)}var ot=e.from_html('<time class="trim-duration svelte-j9q3sk"> </time>'),nt=e.from_html('<time class="duration svelte-j9q3sk"> </time>'),lt=e.from_html('<time class="duration svelte-j9q3sk">0:00</time>'),dt=e.from_html('<div class="timestamps svelte-j9q3sk"><time class="time svelte-j9q3sk">0:00</time> <div><!> <!></div></div>'),ut=e.from_html('<div class="component-wrapper svelte-j9q3sk"><div class="microphone svelte-j9q3sk" data-testid="microphone-waveform"></div> <div data-testid="recording-waveform"></div> <!> <!> <!></div>');function ct(I,t){e.push(t,!1);let s=e.prop(t,"mode",12),a=e.prop(t,"i18n",12),u=e.prop(t,"dispatch_blob",12),r=e.prop(t,"waveform_settings",12),o=e.prop(t,"waveform_options",28,()=>({show_recording_waveform:!0})),p=e.prop(t,"handle_reset_value",12),h=e.prop(t,"editable",12,!0),m=e.prop(t,"recording",12,!1),l,n=e.mutable_source(),_=e.mutable_source(!1),y=e.mutable_source(),v=e.mutable_source(),f=e.mutable_source(),R=e.mutable_source(null),D=e.mutable_source(),B=e.mutable_source(),N=e.mutable_source(),A=e.mutable_source(0),j,x=e.mutable_source(!1),E=e.mutable_source(0);const c=()=>{clearInterval(j),j=setInterval(()=>{e.update(A)},1e3)},b=be();function S(){if(c(),e.set(x,!0),b("start_recording"),o().show_recording_waveform){let d=e.get(v);d&&(d.style.display="block")}}async function M(d){e.set(A,0),e.set(x,!1),clearInterval(j);try{const W=await d.arrayBuffer(),K=await new AudioContext({sampleRate:r().sampleRate}).decodeAudioData(W);K&&await We(K).then(async te=>{await u()([te],"change"),await u()([te],"stop_recording")})}catch(W){console.error(W)}}let U=e.mutable_source(!1);const O=()=>{e.get(v)&&e.mutate(v,e.get(v).innerHTML=""),l!==void 0&&l.destroy(),e.get(v)&&(l=he.create({...r(),normalize:!1,container:e.get(v)}),e.set(f,l.registerPlugin(de.create())),e.get(f)?.on("record-end",M),e.get(f)?.on("record-start",S),e.get(f)?.on("record-pause",()=>{b("pause_recording"),clearInterval(j)}),e.get(f)?.on("record-end",d=>{e.set(R,URL.createObjectURL(d));const W=e.get(v),H=e.get(y);W&&(W.style.display="none"),H&&e.get(R)&&(H.innerHTML="",k())}),e.set(U,!0))},k=()=>{let d=e.get(y);!e.get(R)||!d||e.set(n,he.create({container:d,url:e.get(R),...r()}))},g=async(d,W)=>{s("edit");const H=e.get(n).getDecodedData();H&&await We(H,d,W).then(async K=>{await u()([K],"change"),await u()([K],"stop_recording"),e.get(n).destroy(),k()}),b("edit")};ge(()=>{O(),window.addEventListener("keydown",d=>{e.get(y)&&e.get(y).contains(document.activeElement)&&(d.key==="ArrowRight"?ke(e.get(n),.1):d.key==="ArrowLeft"&&ke(e.get(n),-.1))})}),e.legacy_pre_effect(()=>e.get(f),()=>{e.get(f)?.on("record-resume",()=>{c()})}),e.legacy_pre_effect(()=>(e.get(n),e.get(B),Z),()=>{e.get(n)?.on("decode",d=>{e.set(N,d),e.get(B)&&e.mutate(B,e.get(B).textContent=Z(d))})}),e.legacy_pre_effect(()=>(e.get(n),e.get(D),Z),()=>{e.get(n)?.on("timeupdate",d=>e.get(D)&&e.mutate(D,e.get(D).textContent=Z(d)))}),e.legacy_pre_effect(()=>e.get(n),()=>{e.get(n)?.on("pause",()=>{b("pause"),e.set(_,!1)})}),e.legacy_pre_effect(()=>e.get(n),()=>{e.get(n)?.on("play",()=>{b("play"),e.set(_,!0)})}),e.legacy_pre_effect(()=>e.get(n),()=>{e.get(n)?.on("finish",()=>{b("stop"),e.set(_,!1)})}),e.legacy_pre_effect_reset();var T={get mode(){return s()},set mode(d){s(d),e.flush()},get i18n(){return a()},set i18n(d){a(d),e.flush()},get dispatch_blob(){return u()},set dispatch_blob(d){u(d),e.flush()},get waveform_settings(){return r()},set waveform_settings(d){r(d),e.flush()},get waveform_options(){return o()},set waveform_options(d){o(d),e.flush()},get handle_reset_value(){return p()},set handle_reset_value(d){p(d),e.flush()},get editable(){return h()},set editable(d){h(d),e.flush()},get recording(){return m()},set recording(d){m(d),e.flush()}};e.init();var C=ut(),G=e.child(C);e.bind_this(G,d=>e.set(v,d),()=>e.get(v));var w=e.sibling(G,2);e.bind_this(w,d=>e.set(y,d),()=>e.get(y));var Y=e.sibling(w,2);{var ee=d=>{var W=dt(),H=e.child(W);e.bind_this(H,F=>e.set(D,F),()=>e.get(D));var K=e.sibling(H,2),te=e.child(K);{var ie=F=>{var V=ot(),Q=e.child(V,!0);e.reset(V),e.template_effect(ae=>e.set_text(Q,ae),[()=>(e.deep_read_state(Z),e.get(E),e.untrack(()=>Z(e.get(E))))]),e.append(F,V)};e.if(te,F=>{s()==="edit"&&e.get(E)>0&&F(ie)})}var _e=e.sibling(te,2);{var ue=F=>{var V=nt(),Q=e.child(V,!0);e.reset(V),e.template_effect(ae=>e.set_text(Q,ae),[()=>(e.deep_read_state(Z),e.get(A),e.untrack(()=>Z(e.get(A))))]),e.append(F,V)},pe=F=>{var V=lt();e.bind_this(V,Q=>e.set(B,Q),()=>e.get(B)),e.append(F,V)};e.if(_e,F=>{e.get(x)?F(ue):F(pe,!1)})}e.reset(K),e.reset(W),e.append(d,W)};e.if(Y,d=>{e.get(x),e.get(R),e.deep_read_state(o()),e.untrack(()=>(e.get(x)||e.get(R))&&o().show_recording_waveform)&&d(ee)})}var re=e.sibling(Y,2);{var $=d=>{{let W=e.derived_safe_equal(()=>(e.deep_read_state(Z),e.get(A),e.untrack(()=>Z(e.get(A)))));it(d,{get i18n(){return a()},get timing(){return e.get(x)},get recording(){return m()},get show_recording_waveform(){return e.deep_read_state(o()),e.untrack(()=>o().show_recording_waveform)},get record_time(){return e.get(W)},get record(){return e.get(f)},set record(H){e.set(f,H)},$$legacy:!0})}};e.if(re,d=>{e.get(v)&&!e.get(R)&&e.get(U)&&d($)})}var we=e.sibling(re,2);{var z=d=>{Ce(d,{get container(){return e.get(y)},get playing(){return e.get(_)},get audio_duration(){return e.get(N)},get i18n(){return a()},get editable(){return h()},interactive:!0,handle_trim_audio:g,show_redo:!0,get handle_reset_value(){return p()},get waveform_options(){return o()},get waveform(){return e.get(n)},set waveform(W){e.set(n,W)},get trimDuration(){return e.get(E)},set trimDuration(W){e.set(E,W)},get mode(){return s()},set mode(W){s(W)},$$legacy:!0})};e.if(we,d=>{e.get(n)&&e.get(R)&&d(z)})}return e.reset(C),e.append(I,C),e.pop(T)}var gt=e.from_html('<div class="svelte-m6ymia"></div>'),_t=e.from_html('<button><span class="record-icon svelte-m6ymia"><span class="pinger svelte-m6ymia"></span> <span class="dot svelte-m6ymia"></span></span> </button>'),pt=e.from_html('<button class="spinner-button svelte-m6ymia"><div class="icon svelte-m6ymia"><!></div> </button>'),mt=e.from_html('<button class="record-button svelte-m6ymia"><span class="record-icon svelte-m6ymia"><span class="dot svelte-m6ymia"></span></span> </button>'),vt=e.from_html('<div class="mic-wrap svelte-m6ymia"><!> <div class="controls svelte-m6ymia"><!> <!></div></div>');function ft(I,t){e.push(t,!1);let s=e.prop(t,"recording",12,!1),a=e.prop(t,"paused_recording",12,!1),u=e.prop(t,"stop",12),r=e.prop(t,"record",12),o=e.prop(t,"i18n",12),p=e.prop(t,"waveform_settings",12),h=e.prop(t,"waveform_options",28,()=>({show_recording_waveform:!0})),m=e.prop(t,"waiting",12,!1),l,n=e.mutable_source(),_=e.mutable_source(),y=e.mutable_source([]);ge(()=>{v()});const v=()=>{l!==void 0&&l.destroy(),e.get(_)&&(l=he.create({...p(),normalize:!1,container:e.get(_)}),e.set(n,l.registerPlugin(de.create())))};var f={get recording(){return s()},set recording(c){s(c),e.flush()},get paused_recording(){return a()},set paused_recording(c){a(c),e.flush()},get stop(){return u()},set stop(c){u(c),e.flush()},get record(){return r()},set record(c){r(c),e.flush()},get i18n(){return o()},set i18n(c){o(c),e.flush()},get waveform_settings(){return p()},set waveform_settings(c){p(c),e.flush()},get waveform_options(){return h()},set waveform_options(c){h(c),e.flush()},get waiting(){return m()},set waiting(c){m(c),e.flush()}};e.init();var R=vt(),D=e.child(R);{var B=c=>{var b=gt();let S;e.bind_this(b,M=>e.set(_,M),()=>e.get(_)),e.template_effect(()=>S=e.set_style(b,"",S,{display:s()?"block":"none"})),e.append(c,b)};e.if(D,c=>{e.deep_read_state(h()),e.untrack(()=>h().show_recording_waveform)&&c(B)})}var N=e.sibling(D,2),A=e.child(N);{var j=c=>{var b=_t(),S=e.sibling(e.child(b));e.reset(b),e.template_effect(M=>{e.set_class(b,1,e.clsx(a()?"stop-button-paused":"stop-button"),"svelte-m6ymia"),e.set_text(S,` ${M??""}`)},[()=>(e.deep_read_state(a()),e.deep_read_state(o()),e.untrack(()=>a()?o()("audio.pause"):o()("audio.stop")))]),e.event("click",b,()=>{e.get(n)?.stopMic(),u()()}),e.append(c,b)},x=c=>{var b=e.comment(),S=e.first_child(b);{var M=O=>{var k=pt(),g=e.child(k),T=e.child(g);Ve(T),e.reset(g);var C=e.sibling(g);e.reset(k),e.template_effect(G=>e.set_text(C,` ${G??""}`),[()=>(e.deep_read_state(o()),e.untrack(()=>o()("audio.waiting")))]),e.event("click",k,()=>{u()()}),e.append(O,k)},U=O=>{var k=mt(),g=e.sibling(e.child(k));e.reset(k),e.template_effect(T=>e.set_text(g,` ${T??""}`),[()=>(e.deep_read_state(o()),e.untrack(()=>o()("audio.record")))]),e.event("click",k,()=>{e.get(n)?.startMic(),r()()}),e.append(O,k)};e.if(S,O=>{s()&&m()?O(M):O(U,!1)},!0)}e.append(c,b)};e.if(A,c=>{s()&&!m()?c(j):c(x,!1)})}var E=e.sibling(A,2);return Be(E,{get i18n(){return o()},get micDevices(){return e.get(y)},set micDevices(c){e.set(y,c)},$$legacy:!0}),e.reset(N),e.reset(R),e.append(I,R),e.pop(f)}let Ae;async function ht(){const{MediaRecorder:I,register:t}=await Pe(async()=>{const{MediaRecorder:a,register:u}=await import("./module-FFb15TvM.js");return{MediaRecorder:a,register:u}},__vite__mapDeps([0,1]),import.meta.url),{connect:s}=await Pe(async()=>{const{connect:a}=await import("./module-8x-imyhh.js");return{connect:a}},__vite__mapDeps([2,1]),import.meta.url);return t(await s()),Ae=I,Ae}var bt=e.from_html("<!> <!>",1),wt=e.from_html("<!> <!>",1),yt=e.from_html("<!> <div><!> <!> <!></div>",1);function Rt(I,t){e.push(t,!1);let s=e.prop(t,"value",12,null),a=e.prop(t,"subtitles",12,null),u=e.prop(t,"label",12),r=e.prop(t,"root",12),o=e.prop(t,"loop",12),p=e.prop(t,"show_label",12,!0),h=e.prop(t,"buttons",28,()=>["download","share"]),m=e.prop(t,"sources",28,()=>["microphone","upload"]),l=e.prop(t,"pending",12,!1),n=e.prop(t,"streaming",12,!1),_=e.prop(t,"i18n",12),y=e.prop(t,"waveform_settings",12),v=e.prop(t,"trim_region_settings",28,()=>({})),f=e.prop(t,"waveform_options",28,()=>({})),R=e.prop(t,"dragging",12),D=e.prop(t,"active_source",12),B=e.prop(t,"handle_reset_value",12,()=>{}),N=e.prop(t,"editable",12,!0),A=e.prop(t,"max_file_size",12,null),j=e.prop(t,"upload",12),x=e.prop(t,"stream_handler",12),E=e.prop(t,"stream_every",12,.1),c=e.prop(t,"uploading",12,!1),b=e.prop(t,"recording",12,!1),S=e.prop(t,"class_name",12,""),M=e.prop(t,"upload_promise",12,null),U=e.prop(t,"initial_value",12,null),O=e.prop(t,"time_limit",12,null),k=e.prop(t,"stream_state",12,"closed"),g=e.mutable_source(),T=e.mutable_source(""),C=e.mutable_source(void 0),G=e.mutable_source([]),w=e.mutable_source(!1),Y=!1,ee;const re=44;let $=[];typeof window<"u"&&n()&&ht().then(i=>{ee=i});const z=be(),d=i=>i.map(P=>P instanceof Blob?P:P.slice()),W=async(i,P)=>{let J=new File(d(i),"audio.wav",{type:"audio/wav"});if(J.size===0)return;const se=await Ge([J],P==="stream");U(s()),s((await j()(se,r(),void 0,A()||void 0))?.filter(Boolean)[0]),z(P,s())};Ee(()=>{n()&&e.get(g)&&e.get(g).state!=="inactive"&&e.get(g).stop()});async function H(){let i;try{i=await navigator.mediaDevices.getUserMedia({audio:!0})}catch(P){if(!navigator.mediaDevices){z("error",_()("audio.no_device_support"));return}if(P instanceof DOMException&&P.name=="NotAllowedError"){z("error",_()("audio.allow_recording_access"));return}throw P}i!=null&&(n()?(e.set(g,new ee(i,{mimeType:"audio/wav"})),e.get(g).addEventListener("dataavailable",K)):(e.set(g,new MediaRecorder(i)),e.get(g).addEventListener("dataavailable",P=>{$.push(P.data)})),e.get(g).addEventListener("stop",async()=>{b(!1),e.get(g).stop(),await W($,"change"),await W($,"stop_recording"),$=[]}),Y=!0)}async function K(i){let P=await i.data.arrayBuffer(),J=new Uint8Array(P);if(e.get(C)||(e.set(C,new Uint8Array(P.slice(0,re))),J=new Uint8Array(P.slice(re))),l())e.get(G).push(J);else{let se=[e.get(C)].concat(e.get(G),[J]);if(!b()||k()==="waiting")return;W(se,"stream"),e.set(G,[])}}async function te(){b(!0),z("start_recording"),Y||await H(),e.set(C,void 0),n()&&e.get(g).state!="recording"&&e.get(g).start(E()*1e3)}function ie(){z("change",null),z("clear"),e.set(T,""),s(null)}function _e({detail:i}){s(i),z("change",i),z("upload",i)}async function ue(){b(!1),n()&&(z("close_stream"),z("stop_recording"),e.get(g).stop(),l()&&e.set(w,!0),W($,"stop_recording"),z("clear"),e.set(T,""))}e.legacy_pre_effect(()=>e.deep_read_state(R()),()=>{z("drag",R())}),e.legacy_pre_effect(()=>(e.get(w),e.deep_read_state(l()),e.get(C),e.get(G)),()=>{if(e.get(w)&&l()===!1&&(e.set(w,!1),e.get(C)&&e.get(G))){let i=[e.get(C)].concat(e.get(G));e.set(G,[]),W(i,"stream")}}),e.legacy_pre_effect(()=>(e.deep_read_state(b()),e.get(g)),()=>{!b()&&e.get(g)&&ue()}),e.legacy_pre_effect(()=>(e.deep_read_state(b()),e.get(g)),()=>{b()&&e.get(g)&&te()}),e.legacy_pre_effect_reset();var pe={get value(){return s()},set value(i){s(i),e.flush()},get subtitles(){return a()},set subtitles(i){a(i),e.flush()},get label(){return u()},set label(i){u(i),e.flush()},get root(){return r()},set root(i){r(i),e.flush()},get loop(){return o()},set loop(i){o(i),e.flush()},get show_label(){return p()},set show_label(i){p(i),e.flush()},get buttons(){return h()},set buttons(i){h(i),e.flush()},get sources(){return m()},set sources(i){m(i),e.flush()},get pending(){return l()},set pending(i){l(i),e.flush()},get streaming(){return n()},set streaming(i){n(i),e.flush()},get i18n(){return _()},set i18n(i){_(i),e.flush()},get waveform_settings(){return y()},set waveform_settings(i){y(i),e.flush()},get trim_region_settings(){return v()},set trim_region_settings(i){v(i),e.flush()},get waveform_options(){return f()},set waveform_options(i){f(i),e.flush()},get dragging(){return R()},set dragging(i){R(i),e.flush()},get active_source(){return D()},set active_source(i){D(i),e.flush()},get handle_reset_value(){return B()},set handle_reset_value(i){B(i),e.flush()},get editable(){return N()},set editable(i){N(i),e.flush()},get max_file_size(){return A()},set max_file_size(i){A(i),e.flush()},get upload(){return j()},set upload(i){j(i),e.flush()},get stream_handler(){return x()},set stream_handler(i){x(i),e.flush()},get stream_every(){return E()},set stream_every(i){E(i),e.flush()},get uploading(){return c()},set uploading(i){c(i),e.flush()},get recording(){return b()},set recording(i){b(i),e.flush()},get class_name(){return S()},set class_name(i){S(i),e.flush()},get upload_promise(){return M()},set upload_promise(i){M(i),e.flush()},get initial_value(){return U()},set initial_value(i){U(i),e.flush()},get time_limit(){return O()},set time_limit(i){O(i),e.flush()},get stream_state(){return k()},set stream_state(i){k(i),e.flush()}};e.init();var F=yt(),V=e.first_child(F);{let i=e.derived_safe_equal(()=>D()==="upload"&&s()===null),P=e.derived_safe_equal(()=>(e.deep_read_state(u()),e.deep_read_state(_()),e.untrack(()=>u()||_()("audio.audio"))));Ye(V,{get show_label(){return p()},get Icon(){return Je},get float(){return e.get(i)},get label(){return e.get(P)}})}var Q=e.sibling(V,2),ae=e.child(Q);qe(ae,{get time_limit(){return O()}});var ye=e.sibling(ae,2);{var Ue=i=>{var P=e.comment(),J=e.first_child(P);{var se=L=>{var ne=bt(),ce=e.first_child(ne);De(ce,{get i18n(){return _()},$$events:{clear:ie}});var me=e.sibling(ce,2);{var le=q=>{{let X=e.derived_safe_equal(()=>k()==="waiting");ft(q,{record:te,get recording(){return b()},stop:ue,get i18n(){return _()},get waveform_settings(){return y()},get waveform_options(){return f()},get waiting(){return e.get(X)}})}},ve=q=>{ct(q,{get i18n(){return _()},get editable(){return N()},get recording(){return b()},dispatch_blob:W,get waveform_settings(){return y()},get waveform_options(){return f()},get handle_reset_value(){return B()},get mode(){return e.get(T)},set mode(X){e.set(T,X)},$$events:{start_recording(X){e.bubble_event.call(this,t,X)},pause_recording(X){e.bubble_event.call(this,t,X)},stop_recording(X){e.bubble_event.call(this,t,X)}},$$legacy:!0})};e.if(me,q=>{n()?q(le):q(ve,!1)})}e.append(L,ne)},oe=L=>{var ne=e.comment(),ce=e.first_child(ne);{var me=le=>{{let ve=e.derived_safe_equal(()=>(e.deep_read_state(_()),e.untrack(()=>_()("audio.drop_to_upload"))));Ne(le,{filetype:"audio/aac,audio/midi,audio/mpeg,audio/ogg,audio/wav,audio/x-wav,audio/opus,audio/webm,audio/flac,audio/vnd.rn-realaudio,audio/x-ms-wma,audio/x-aiff,audio/amr,audio/*",get root(){return r()},get max_file_size(){return A()},get upload(){return j()},get stream_handler(){return x()},get aria_label(){return e.get(ve)},get upload_promise(){return M()},set upload_promise(q){M(q)},get dragging(){return R()},set dragging(q){R(q)},get uploading(){return c()},set uploading(q){c(q)},$$events:{load:_e,error:({detail:q})=>z("error",q)},children:(q,X)=>{var Re=e.comment(),je=e.first_child(Re);e.slot(je,t,"default",{},null),e.append(q,Re)},$$slots:{default:!0},$$legacy:!0})}};e.if(ce,le=>{D()==="upload"&&le(me)},!0)}e.append(L,ne)};e.if(J,L=>{D()==="microphone"?L(se):L(oe,!1)})}e.append(i,P)},Ie=i=>{var P=wt(),J=e.first_child(P);{let oe=e.derived_safe_equal(()=>(e.deep_read_state(h()),e.deep_read_state(s()),e.untrack(()=>h()===null||h().includes("download")?s().url:null)));De(J,{get i18n(){return _()},get download(){return e.get(oe)},$$events:{clear:ie,edit:()=>e.set(T,"edit")}})}var se=e.sibling(J,2);{let oe=e.derived_safe_equal(()=>(e.deep_read_state(a()),e.untrack(()=>Array.isArray(a())?a():a()?.url)));ze(se,{get value(){return s()},get subtitles(){return e.get(oe)},get label(){return u()},get i18n(){return _()},dispatch_blob:W,get waveform_settings(){return y()},get waveform_options(){return f()},get trim_region_settings(){return v()},get handle_reset_value(){return B()},get editable(){return N()},get loop(){return o()},interactive:!0,get mode(){return e.get(T)},set mode(L){e.set(T,L)},$$events:{stop(L){e.bubble_event.call(this,t,L)},play(L){e.bubble_event.call(this,t,L)},pause(L){e.bubble_event.call(this,t,L)},edit(L){e.bubble_event.call(this,t,L)}},$$legacy:!0})}e.append(i,P)};e.if(ye,i=>{s()===null||n()?i(Ue):i(Ie,!1)})}var Oe=e.sibling(ye,2);return Ke(Oe,{get sources(){return m()},handle_clear:ie,get active_source(){return D()},set active_source(i){D(i)},$$legacy:!0}),e.reset(Q),e.template_effect(()=>{e.set_class(Q,1,`audio-container ${S()??""}`,"svelte-ocxd3m"),e.set_attribute(Q,"data-testid",u()?"waveform-"+u():"unlabelled-audio")}),e.append(I,F),e.pop(pe)}var xt=e.from_html("<!> <!>",1),kt=e.from_html("<!> <!>",1);function Ot(I,t){e.push(t,!0);let s=e.rest_props(t,["$$slots","$$events","$$legacy"]),a=e.state(void 0);t.props.stream_every=.1;class u extends Le{async get_data(){return e.get(a)&&(await e.get(a),await Te()),await super.get_data()}}const r=new u(s);let o=e.derived(()=>r.shared.label||r.i18n("audio.audio")),p=e.derived(()=>t.minimal??r.props.minimal??!1),h=e.derived(()=>r.props.sources?r.props.sources[0]:null),m=r.props.value;const l=()=>{m===null||r.props.value===m||(r.props.value=m)};let n,_="darkorange",y=e.derived(()=>({height:50,barWidth:2,barGap:3,cursorWidth:2,cursorColor:"#ddd5e9",autoplay:r.props.autoplay,barRadius:10,dragToSeek:!0,normalize:!0,minPxPerSec:20}));const v={color:r.props.waveform_options.trim_region_color,drag:!0,resize:!0};function f(){document.documentElement.style.setProperty("--trim-region-color",v.color||_)}function R({detail:x}){const[E,c]=x.includes("Invalid file type")?["warning","complete"]:["error","error"];r.shared.loading_status&&(r.shared.loading_status.status=c,r.shared.loading_status.message=x),r.dispatch(E,x)}let D=e.state(e.proxy(r.props.value));e.user_effect(()=>{e.get(D)!=r.props.value&&(e.set(D,r.props.value,!0),r.dispatch("change"))}),ge(()=>{_=getComputedStyle(document?.documentElement).getPropertyValue("--color-accent"),f(),e.get(y).waveColor=r.props.waveform_options.waveform_color||"#9ca3af",e.get(y).progressColor=r.props.waveform_options.waveform_progress_color||_,e.get(y).mediaControls=r.props.waveform_options.show_controls,e.get(y).sampleRate=r.props.waveform_options.sample_rate||44100});var B=e.comment(),N=e.first_child(B);{var A=x=>{{let E=e.derived(()=>n?"focus":"base");Se(x,{variant:"solid",get border_mode(){return e.get(E)},padding:!1,allow_overflow:!1,get elem_id(){return r.shared.elem_id},get elem_classes(){return r.shared.elem_classes},get visible(){return r.shared.visible},get container(){return r.shared.container},get scale(){return r.shared.scale},get min_width(){return r.shared.min_width},children:(c,b)=>{var S=xt(),M=e.first_child(S);xe(M,e.spread_props({get autoscroll(){return r.shared.autoscroll},get i18n(){return r.i18n}},()=>r.shared.loading_status,{on_clear_status:()=>r.dispatch("clear_status",r.shared.loading_status)}));var U=e.sibling(M,2);{let O=e.derived(()=>r.props.buttons??["download","share"]);Fe(U,{get i18n(){return r.i18n},get show_label(){return r.shared.show_label},get buttons(){return e.get(O)},get value(){return r.props.value},get subtitles(){return r.props.subtitles},get label(){return e.get(o)},get loop(){return r.props.loop},get waveform_settings(){return e.get(y)},get waveform_options(){return r.props.waveform_options},get editable(){return r.props.editable},get minimal(){return e.get(p)},$$events:{share:k=>r.dispatch("share",k.detail),error:k=>r.dispatch("error",k.detail),play:()=>r.dispatch("play"),pause:()=>r.dispatch("pause"),stop:()=>r.dispatch("stop")}})}e.append(c,S)},$$slots:{default:!0}})}},j=x=>{{let E=e.derived(()=>r.props.value===null&&e.get(h)==="upload"?"dashed":"solid"),c=e.derived(()=>n?"focus":"base");Se(x,{get variant(){return e.get(E)},get border_mode(){return e.get(c)},padding:!1,allow_overflow:!1,get elem_id(){return r.shared.elem_id},get elem_classes(){return r.shared.elem_classes},get visible(){return r.shared.visible},get container(){return r.shared.container},get scale(){return r.shared.scale},get min_width(){return r.shared.min_width},children:(b,S)=>{var M=kt(),U=e.first_child(M);xe(U,e.spread_props({get autoscroll(){return r.shared.autoscroll},get i18n(){return r.i18n}},()=>r.shared.loading_status,{on_clear_status:()=>r.dispatch("clear_status",r.shared.loading_status)}));var O=e.sibling(U,2);{let k=e.derived(()=>r.props.buttons??[]);Rt(O,{get label(){return e.get(o)},get show_label(){return r.shared.show_label},get buttons(){return e.get(k)},get value(){return r.props.value},get subtitles(){return r.props.subtitles},get root(){return r.shared.root},get sources(){return r.props.sources},get active_source(){return e.get(h)},get pending(){return r.shared.loading_status.pending},get streaming(){return r.props.streaming},get loop(){return r.props.loop},get max_file_size(){return r.shared.max_file_size},handle_reset_value:l,get editable(){return r.props.editable},get i18n(){return r.i18n},get waveform_settings(){return e.get(y)},get waveform_options(){return r.props.waveform_options},get trim_region_settings(){return v},get stream_every(){return r.props.stream_every},get stream_state(){return r.shared.loading_status.stream_state},upload:(...g)=>r.shared.client.upload(...g),stream_handler:(...g)=>r.shared.client.stream(...g),get time_limit(){return r.shared.loading_status.time_limit},get upload_promise(){return e.get(a)},set upload_promise(g){e.set(a,g,!0)},get initial_value(){return m},set initial_value(g){m=g},get recording(){return r.props.recording},set recording(g){r.props.recording=g},get dragging(){return n},set dragging(g){n=g},$$events:{change:({detail:g})=>r.props.value=g,stream:({detail:g})=>{r.props.value=g,r.dispatch("stream",r.props.value)},drag:({detail:g})=>n=g,edit:()=>r.dispatch("edit"),play:()=>r.dispatch("play"),pause:()=>r.dispatch("pause"),stop:()=>r.dispatch("stop"),start_recording:()=>r.dispatch("start_recording"),pause_recording:()=>r.dispatch("pause_recording"),stop_recording:g=>{r.dispatch("stop_recording"),r.dispatch("input")},upload:()=>{r.dispatch("upload"),r.dispatch("input")},clear:()=>{r.dispatch("clear"),r.dispatch("input")},error:R,close_stream:()=>r.dispatch("close_stream","stream")},children:(g,T)=>{Qe(g,{get i18n(){return r.i18n},type:"audio"})},$$slots:{default:!0}})}e.append(b,M)},$$slots:{default:!0}})}};e.if(N,x=>{r.shared.interactive?x(j,!1):x(A)})}e.append(I,B),e.pop()}export{Ot as I,Rt as a,de as o};
