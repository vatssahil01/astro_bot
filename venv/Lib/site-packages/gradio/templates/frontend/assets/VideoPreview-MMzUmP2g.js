import"./svelte/svelte_internal_flags_legacy.js";import"./svelte/svelte_internal_flags_async.js";import*as e from"./svelte/svelte_internal_client.js";import{onMount as Z,onDestroy as de,createEventDispatcher as te,afterUpdate as ue,tick as _e}from"./svelte/svelte_svelte.js";import{I as $,f as re,w as ce,a as ge,n as ve,x as he,b as fe,V as ee,E as me,c as pe,j as be,D as we}from"./IconButtonWrapper-CKkeBFM2.js";import{S as ye}from"./ShareButton-l5f_cszo.js";import"./i18n-jwgpNIDD.js";import{f as G,u as ke}from"./utils.svelte-Ceck75cM.js";import{b as xe,t as Ee,V as Te}from"./Video-06U9X4-1.js";import{M as De}from"./ModifyUpload-BeEGCb3i.js";import{p as Ve}from"./index-CGvp2os9.js";var Pe=e.from_html('<div class="load-wrap svelte-mctcyk"><span aria-label="loading timeline" class="loader svelte-mctcyk"></span></div>'),Le=e.from_html('<img draggable="false" class="svelte-mctcyk"/>'),Re=e.from_html('<div id="timeline" class="thumbnail-wrapper svelte-mctcyk"><button aria-label="start drag handle for trimming video" class="handle left svelte-mctcyk"></button> <div class="opaque-layer svelte-mctcyk"></div> <!> <button aria-label="end drag handle for trimming video" class="handle right svelte-mctcyk"></button></div>'),Se=e.from_html('<div class="container svelte-mctcyk"><!></div>');function Me(O,t){e.push(t,!1);let l=e.prop(t,"videoElement",12),y=e.prop(t,"trimmedDuration",12),V=e.prop(t,"dragStart",12),d=e.prop(t,"dragEnd",12),P=e.prop(t,"loadingTimeline",12),E=e.mutable_source([]),k=10,f,c=e.mutable_source(0),g=e.mutable_source(100),m=null;const T=a=>{m=a},S=()=>{m=null},v=(a,o)=>{if(m){const h=document.getElementById("timeline");if(!h)return;const b=h.getBoundingClientRect();let x=(a.clientX-b.left)/b.width*100;if(o?x=m==="left"?e.get(c)+o:e.get(g)+o:x=(a.clientX-b.left)/b.width*100,x=Math.max(0,Math.min(x,100)),m==="left"){e.set(c,Math.min(x,e.get(g)));const M=e.get(c)/100*f;l(l().currentTime=M,!0),V(M)}else if(m==="right"){e.set(g,Math.max(x,e.get(c)));const M=e.get(g)/100*f;l(l().currentTime=M,!0),d(M)}const A=e.get(c)/100*f,_=e.get(g)/100*f;y(_-A),e.set(c,e.get(c)),e.set(g,e.get(g))}},I=a=>{if(m){const o=1/f*100;a.key==="ArrowLeft"?v({clientX:0},-o):a.key==="ArrowRight"&&v({clientX:0},o)}},X=()=>{const a=document.createElement("canvas"),o=a.getContext("2d");if(!o)return;a.width=l().videoWidth,a.height=l().videoHeight,o.drawImage(l(),0,0,a.width,a.height);const h=a.toDataURL("image/jpeg",.7);e.set(E,[...e.get(E),h])};Z(()=>{const a=()=>{f=l().duration;const o=f/k;let h=0;const b=()=>{X(),h++,h<k?l(l().currentTime+=o,!0):l().removeEventListener("seeked",b)};l().addEventListener("seeked",b),l(l().currentTime=0,!0)};l().readyState>=1?a():l().addEventListener("loadedmetadata",a)}),de(()=>{window.removeEventListener("mousemove",v),window.removeEventListener("mouseup",S),window.removeEventListener("keydown",I)}),Z(()=>{window.addEventListener("mousemove",v),window.addEventListener("mouseup",S),window.addEventListener("keydown",I)}),e.legacy_pre_effect(()=>e.get(E),()=>{P(e.get(E).length!==k)}),e.legacy_pre_effect_reset();var q={get videoElement(){return l()},set videoElement(a){l(a),e.flush()},get trimmedDuration(){return y()},set trimmedDuration(a){y(a),e.flush()},get dragStart(){return V()},set dragStart(a){V(a),e.flush()},get dragEnd(){return d()},set dragEnd(a){d(a),e.flush()},get loadingTimeline(){return P()},set loadingTimeline(a){P(a),e.flush()}};e.init();var C=Se(),D=e.child(C);{var p=a=>{var o=Pe();e.append(a,o)},s=a=>{var o=Re(),h=e.child(o),b=e.sibling(h,2),x=e.sibling(b,2);e.each(x,1,()=>e.get(E),e.index,(_,M,n)=>{var w=Le();e.set_attribute(w,"alt",`frame-${n}`),e.template_effect(()=>e.set_attribute(w,"src",e.get(M))),e.append(_,w)});var A=e.sibling(x,2);e.reset(o),e.template_effect(()=>{e.set_style(h,`left: ${e.get(c)??""}%;`),e.set_style(b,`left: ${e.get(c)??""}%; right: ${100-e.get(g)}%`),e.set_style(A,`left: ${e.get(g)??""}%;`)}),e.event("mousedown",h,()=>T("left")),e.event("blur",h,S),e.event("keydown",h,_=>{(_.key==="ArrowLeft"||_.key=="ArrowRight")&&T("left")}),e.event("mousedown",A,()=>T("right")),e.event("blur",A,S),e.event("keydown",A,_=>{(_.key==="ArrowLeft"||_.key=="ArrowRight")&&T("right")}),e.append(a,o)};e.if(D,a=>{P()?a(p):a(s,!1)})}return e.reset(C),e.append(O,C),e.pop(q)}var qe=e.from_html('<div class="timeline-wrapper svelte-1orxdv"><!></div>'),Ae=e.from_html('<time aria-label="duration of selected region in seconds"> </time> <div class="edit-buttons svelte-1orxdv"><button>Trim</button> <button>Cancel</button></div>',1),Be=e.from_html('<div class="svelte-1orxdv"></div>'),Ie=e.from_html("<!> <!>",1),Xe=e.from_html('<div><!> <div class="controls svelte-1orxdv" data-testid="waveform-controls"><!></div></div> <!>',1);function Ce(O,t){e.push(t,!1);let l=e.prop(t,"videoElement",12),y=e.prop(t,"showRedo",12,!1),V=e.prop(t,"interactive",12,!0),d=e.prop(t,"mode",12,""),P=e.prop(t,"handle_reset_value",12),E=e.prop(t,"handle_trim_video",12),k=e.prop(t,"processingVideo",12,!1),f=e.prop(t,"i18n",12),c=e.prop(t,"value",12,null),g=e.prop(t,"show_download_button",12,!1),m=e.prop(t,"handle_clear",12,()=>{}),T=e.prop(t,"has_change_history",12,!1),S=e.mutable_source();Z(async()=>{e.set(S,await xe())});let v=e.mutable_source(null),I=e.mutable_source(0),X=e.mutable_source(0),q=e.mutable_source(!1);const C=()=>{d()==="edit"?(d(""),e.set(v,l().duration)):d("edit")};e.legacy_pre_effect(()=>(e.deep_read_state(d()),e.get(v),e.deep_read_state(l())),()=>{d()==="edit"&&e.get(v)===null&&l()&&e.set(v,l().duration)}),e.legacy_pre_effect_reset();var D={get videoElement(){return l()},set videoElement(n){l(n),e.flush()},get showRedo(){return y()},set showRedo(n){y(n),e.flush()},get interactive(){return V()},set interactive(n){V(n),e.flush()},get mode(){return d()},set mode(n){d(n),e.flush()},get handle_reset_value(){return P()},set handle_reset_value(n){P(n),e.flush()},get handle_trim_video(){return E()},set handle_trim_video(n){E(n),e.flush()},get processingVideo(){return k()},set processingVideo(n){k(n),e.flush()},get i18n(){return f()},set i18n(n){f(n),e.flush()},get value(){return c()},set value(n){c(n),e.flush()},get show_download_button(){return g()},set show_download_button(n){g(n),e.flush()},get handle_clear(){return m()},set handle_clear(n){m(n),e.flush()},get has_change_history(){return T()},set has_change_history(n){T(n),e.flush()}};e.init();var p=Xe(),s=e.first_child(p);let a;var o=e.child(s);{var h=n=>{var w=qe(),B=e.child(w);Me(B,{get videoElement(){return l()},get dragStart(){return e.get(I)},set dragStart(u){e.set(I,u)},get dragEnd(){return e.get(X)},set dragEnd(u){e.set(X,u)},get trimmedDuration(){return e.get(v)},set trimmedDuration(u){e.set(v,u)},get loadingTimeline(){return e.get(q)},set loadingTimeline(u){e.set(q,u)},$$legacy:!0}),e.reset(w),e.append(n,w)};e.if(o,n=>{d()==="edit"&&n(h)})}var b=e.sibling(o,2),x=e.child(b);{var A=n=>{var w=Ae(),B=e.first_child(w);let u;var L=e.child(B,!0);e.reset(B);var U=e.sibling(B,2),H=e.child(U);let F;var R=e.sibling(H,2);let W;e.reset(U),e.template_effect(J=>{u=e.set_class(B,1,"svelte-1orxdv",null,u,{hidden:e.get(q)}),e.set_text(L,J),F=e.set_class(H,1,"text-button svelte-1orxdv",null,F,{hidden:e.get(q)}),W=e.set_class(R,1,"text-button svelte-1orxdv",null,W,{hidden:e.get(q)})},[()=>(e.deep_read_state(G),e.get(v),e.untrack(()=>G(e.get(v))))]),e.event("click",H,()=>{d(""),k(!0),Ee(e.get(S),e.get(I),e.get(X),l()).then(J=>{E()(J)}).then(()=>{k(!1)})}),e.event("click",R,C),e.append(n,w)},_=n=>{var w=Be();e.append(n,w)};e.if(x,n=>{d()==="edit"&&e.get(v)!==null?n(A):n(_,!1)})}e.reset(b),e.reset(s);var M=e.sibling(s,2);{let n=e.derived_safe_equal(()=>(e.deep_read_state(g()),e.deep_read_state(c()),e.untrack(()=>g()?c()?.url:null)));De(M,{get i18n(){return f()},get download(){return e.get(n)},$$events:{clear:()=>m()()},children:(w,B)=>{var u=Ie(),L=e.first_child(u);{var U=R=>{{let W=e.derived_safe_equal(()=>k()||!T());$(R,{get Icon(){return re},label:"Reset video to initial value",get disabled(){return e.get(W)},$$events:{click:()=>{P()(),d("")}}})}};e.if(L,R=>{y()&&d()===""&&R(U)})}var H=e.sibling(L,2);{var F=R=>{$(R,{get Icon(){return ce},label:"Trim video to selection",get disabled(){return k()},$$events:{click:C}})};e.if(H,R=>{V()&&d()===""&&R(F)})}e.append(w,u)},$$slots:{default:!0}})}return e.template_effect(()=>a=e.set_class(s,1,"container svelte-1orxdv",null,a,{hidden:d()!=="edit"})),e.append(O,p),e.pop(D)}var He=e.from_html('<track kind="captions" default/>'),Ue=e.from_html('<div class="wrap svelte-1k28h7x"><div><!></div> <div class="controls svelte-1k28h7x"><div class="inner svelte-1k28h7x"><span role="button" tabindex="0" class="icon svelte-1k28h7x" aria-label="play-pause-replay-button"><!></span> <span class="time svelte-1k28h7x"> </span>  <progress class="svelte-1k28h7x"></progress> <div role="button" tabindex="0" class="icon svelte-1k28h7x" aria-label="full-screen"><!></div></div></div></div> <!>',1);function je(O,t){e.push(t,!1);let l=e.prop(t,"root",12,""),y=e.prop(t,"src",12),V=e.prop(t,"subtitle",12,null),d=e.prop(t,"mirror",12),P=e.prop(t,"autoplay",12),E=e.prop(t,"loop",12),k=e.prop(t,"label",12,"test"),f=e.prop(t,"interactive",12,!1),c=e.prop(t,"handle_change",12,()=>{}),g=e.prop(t,"handle_reset_value",12,()=>{}),m=e.prop(t,"upload",12),T=e.prop(t,"is_stream",12),S=e.prop(t,"i18n",12),v=e.prop(t,"show_download_button",12,!1),I=e.prop(t,"value",12,null),X=e.prop(t,"handle_clear",12,()=>{}),q=e.prop(t,"has_change_history",12,!1);const C=te();let D=e.mutable_source(0),p=e.mutable_source(),s=e.mutable_source(!0),a=e.mutable_source(),o=e.mutable_source(!1);function h(r){if(!e.get(p))return;if(r.type==="click"){x(r);return}if(r.type!=="touchmove"&&!(r.buttons&1))return;const i=r.type==="touchmove"?r.touches[0].clientX:r.clientX,{left:j,right:z}=r.currentTarget.getBoundingClientRect();e.set(D,e.get(p)*(i-j)/(z-j))}async function b(){document.fullscreenElement!=e.get(a)&&(e.get(a).currentTime>0&&!e.get(a).paused&&!e.get(a).ended&&e.get(a).readyState>e.get(a).HAVE_CURRENT_DATA?e.get(a).pause():await e.get(a).play())}function x(r){const{left:i,right:j}=r.currentTarget.getBoundingClientRect();e.set(D,e.get(p)*(r.clientX-i)/(j-i))}function A(){C("stop"),C("end")}const _=async r=>{let i=new File([r],"video.mp4");const j=await Ve([i]);let z=(await m()(j,l()))?.filter(Boolean)[0];c()(z)};function M(){e.get(a).requestFullscreen()}e.legacy_pre_effect(()=>e.get(D),()=>{e.set(D,e.get(D)||0)}),e.legacy_pre_effect(()=>e.get(p),()=>{e.set(p,e.get(p)||0)}),e.legacy_pre_effect_reset();var n={get root(){return l()},set root(r){l(r),e.flush()},get src(){return y()},set src(r){y(r),e.flush()},get subtitle(){return V()},set subtitle(r){V(r),e.flush()},get mirror(){return d()},set mirror(r){d(r),e.flush()},get autoplay(){return P()},set autoplay(r){P(r),e.flush()},get loop(){return E()},set loop(r){E(r),e.flush()},get label(){return k()},set label(r){k(r),e.flush()},get interactive(){return f()},set interactive(r){f(r),e.flush()},get handle_change(){return c()},set handle_change(r){c(r),e.flush()},get handle_reset_value(){return g()},set handle_reset_value(r){g(r),e.flush()},get upload(){return m()},set upload(r){m(r),e.flush()},get is_stream(){return T()},set is_stream(r){T(r),e.flush()},get i18n(){return S()},set i18n(r){S(r),e.flush()},get show_download_button(){return v()},set show_download_button(r){v(r),e.flush()},get value(){return I()},set value(r){I(r),e.flush()},get handle_clear(){return X()},set handle_clear(r){X(r),e.flush()},get has_change_history(){return q()},set has_change_history(r){q(r),e.flush()}};e.init();var w=Ue(),B=e.first_child(w),u=e.child(B);let L;var U=e.child(u);{let r=e.derived_safe_equal(()=>`${k()}-player`);Te(U,{get src(){return y()},preload:"auto",get autoplay(){return P()},get loop(){return E()},get is_stream(){return T()},get"data-testid"(){return e.get(r)},get processingVideo(){return e.get(o)},get currentTime(){return e.get(D)},set currentTime(i){e.set(D,i)},get duration(){return e.get(p)},set duration(i){e.set(p,i)},get paused(){return e.get(s)},set paused(i){e.set(s,i)},get node(){return e.get(a)},set node(i){e.set(a,i)},$$events:{click:b,play(i){e.bubble_event.call(this,t,i)},pause(i){e.bubble_event.call(this,t,i)},error(i){e.bubble_event.call(this,t,i)},ended:A,loadstart(i){e.bubble_event.call(this,t,i)},loadeddata(i){e.bubble_event.call(this,t,i)},loadedmetadata(i){e.bubble_event.call(this,t,i)}},children:(i,j)=>{var z=He();e.template_effect(()=>e.set_attribute(z,"src",V())),e.append(i,z)},$$slots:{default:!0},$$legacy:!0})}e.reset(u);var H=e.sibling(u,2),F=e.child(H),R=e.child(F),W=e.child(R);{var J=r=>{re(r)},le=r=>{var i=e.comment(),j=e.first_child(i);{var z=N=>{ve(N)},oe=N=>{he(N)};e.if(j,N=>{e.get(s)?N(z):N(oe,!1)},!0)}e.append(r,i)};e.if(W,r=>{e.get(D)===e.get(p)?r(J):r(le,!1)})}e.reset(R);var Y=e.sibling(R,2),ae=e.child(Y);e.reset(Y);var K=e.sibling(Y,2),Q=e.sibling(K,2),ne=e.child(Q);ge(ne),e.reset(Q),e.reset(F),e.reset(H),e.reset(B);var se=e.sibling(B,2);{var ie=r=>{Ce(r,{get videoElement(){return e.get(a)},showRedo:!0,handle_trim_video:_,get handle_reset_value(){return g()},get value(){return I()},get i18n(){return S()},get show_download_button(){return v()},get handle_clear(){return X()},get has_change_history(){return q()},get processingVideo(){return e.get(o)},set processingVideo(i){e.set(o,i)},$$legacy:!0})};e.if(se,r=>{f()&&r(ie)})}return e.template_effect((r,i)=>{L=e.set_class(u,1,"mirror-wrap svelte-1k28h7x",null,L,{mirror:d()}),e.set_text(ae,`${r??""} / ${i??""}`),e.set_value(K,e.get(D)/e.get(p)||0)},[()=>(e.deep_read_state(G),e.get(D),e.untrack(()=>G(e.get(D)))),()=>(e.deep_read_state(G),e.get(p),e.untrack(()=>G(e.get(p))))]),e.event("click",R,b),e.event("keydown",R,b),e.event("mousemove",K,h),e.event("touchmove",K,e.preventDefault(h)),e.event("click",K,e.preventDefault(e.stopPropagation(x))),e.event("click",Q,M),e.event("keypress",Q,M),e.append(O,w),e.pop(n)}var Fe=e.from_html("<!> <!>",1),ze=e.from_html('<!> <div data-testid="download-div"><!></div>',1),Oe=e.from_html("<!> <!>",1);function We(O,t){e.push(t,!1);let l=e.prop(t,"value",12,null),y=e.prop(t,"subtitle",12,null),V=e.prop(t,"label",12,void 0),d=e.prop(t,"show_label",12,!0),P=e.prop(t,"autoplay",12),E=e.prop(t,"show_share_button",12,!0),k=e.prop(t,"show_download_button",12,!0),f=e.prop(t,"loop",12),c=e.prop(t,"i18n",12),g=e.prop(t,"upload",12),m=e.prop(t,"display_icon_button_wrapper_top_corner",12,!1),T=null,S=null;const v=te();ue(async()=>{l()!==T&&y()!==S&&S!==null&&(T=l(),l(null),await _e(),l(T)),T=l(),S=y()}),e.legacy_pre_effect(()=>e.deep_read_state(l()),()=>{l()&&v("change",l())}),e.legacy_pre_effect_reset();var I={get value(){return l()},set value(s){l(s),e.flush()},get subtitle(){return y()},set subtitle(s){y(s),e.flush()},get label(){return V()},set label(s){V(s),e.flush()},get show_label(){return d()},set show_label(s){d(s),e.flush()},get autoplay(){return P()},set autoplay(s){P(s),e.flush()},get show_share_button(){return E()},set show_share_button(s){E(s),e.flush()},get show_download_button(){return k()},set show_download_button(s){k(s),e.flush()},get loop(){return f()},set loop(s){f(s),e.flush()},get i18n(){return c()},set i18n(s){c(s),e.flush()},get upload(){return g()},set upload(s){g(s),e.flush()},get display_icon_button_wrapper_top_corner(){return m()},set display_icon_button_wrapper_top_corner(s){m(s),e.flush()}};e.init();var X=Oe(),q=e.first_child(X);{let s=e.derived_safe_equal(()=>V()||"Video");fe(q,{get show_label(){return d()},get Icon(){return ee},get label(){return e.get(s)}})}var C=e.sibling(q,2);{var D=s=>{me(s,{unpadded_box:!0,size:"large",children:(a,o)=>{ee(a)},$$slots:{default:!0}})},p=s=>{var a=ze(),o=e.first_child(a);e.key(o,()=>(e.deep_read_state(l()),e.untrack(()=>l().url)),x=>{{let A=e.derived_safe_equal(()=>(e.deep_read_state(y()),e.untrack(()=>y()?.url)));je(x,{get src(){return e.deep_read_state(l()),e.untrack(()=>l().url)},get subtitle(){return e.get(A)},get is_stream(){return e.deep_read_state(l()),e.untrack(()=>l().is_stream)},get autoplay(){return P()},mirror:!1,get label(){return V()},get loop(){return f()},interactive:!1,get upload(){return g()},get i18n(){return c()},$$events:{play(_){e.bubble_event.call(this,t,_)},pause(_){e.bubble_event.call(this,t,_)},stop(_){e.bubble_event.call(this,t,_)},end(_){e.bubble_event.call(this,t,_)},loadedmetadata:()=>{v("load")}}})}});var h=e.sibling(o,2),b=e.child(h);pe(b,{get display_top_corner(){return m()},children:(x,A)=>{var _=Fe(),M=e.first_child(_);{var n=u=>{{let L=e.derived_safe_equal(()=>(e.deep_read_state(l()),e.untrack(()=>l().is_stream?l().url?.replace("playlist.m3u8","playlist-file"):l().url))),U=e.derived_safe_equal(()=>(e.deep_read_state(l()),e.untrack(()=>l().orig_name||l().path)));be(u,{get href(){return e.get(L)},get download(){return e.get(U)},children:(H,F)=>{$(H,{get Icon(){return we},label:"Download"})},$$slots:{default:!0}})}};e.if(M,u=>{k()&&u(n)})}var w=e.sibling(M,2);{var B=u=>{ye(u,{get i18n(){return c()},get value(){return l()},formatter:async L=>L?await ke(L.data):"",$$events:{error(L){e.bubble_event.call(this,t,L)},share(L){e.bubble_event.call(this,t,L)}}})};e.if(w,u=>{E()&&u(B)})}e.append(x,_)},$$slots:{default:!0}}),e.reset(h),e.append(s,a)};e.if(C,s=>{e.deep_read_state(l()),e.untrack(()=>!l()||l().url===void 0)?s(D):s(p,!1)})}return e.append(O,X),e.pop(I)}const rt=Object.freeze(Object.defineProperty({__proto__:null,default:We},Symbol.toStringTag,{value:"Module"}));export{je as P,We as V,rt as a};
